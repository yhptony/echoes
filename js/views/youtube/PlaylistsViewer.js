define(["jquery","underscore","backbone","views/playlists-viewer/playlist_search","views/playlists-viewer/playlists_list","text!templates/youtube_playlist_list_item.html"],function(e,t,n,r,i,s){var o=n.View.extend({el:"#playlists-viewer",events:{"click .modal-body a":function(t){t.preventDefault(),this.addToPlaylist(e(t.target).data("id"))}},initialize:function(){this.listenTo(this.model,"change:playlist-add",this.show),this.listenTo(this.model.user().playlists,"reset",this.render),this.listenTo(this.model.user().playlists,"add",this.render),this.listenTo(this.model.user().playlists,"change",this.renderGapiResult),this.$el.on("hidden",t.bind(this.reset,this)),this.$el.on("show",t.bind(this.render,this)),this.header=new r({el:this.$(".modal-header"),model:this.model}),this.playlists=new i({el:this.$(".modal-body ul")}),this.filter="",this.listenTo(this.header,"search:change",this.filterPlaylist),this.listenTo(this.header,"search:add",this.createPlaylist),this.render()},render:function(){var e=this.model.user().get("author"),t=this.model.user().playlists;this.playlists.collection.reset(this.getPlaylistsForDisplay(t),{reset:!0});var n=this.playlists.collection.length;this.$el.toggleClass("user-not-signed-in",!e),this.$el.toggleClass("add-new-playlist",!n)},getPlaylistsForDisplay:function(e){var t=this.filter;return e.filter(function(e){return e.get("title").toLowerCase().indexOf(t)>-1},this)},show:function(){this.$el.modal("show")},addToPlaylist:function(e){var t=this.model.get("playlist-add").id;this.model.user().playlists.insert(e,t),this.model.set("playlist-add",!1,{silent:!0});return},renderGapiResult:function(e){var t="the video has been successfuly added to this playlist.",n=e.id;e.set("message",t,{silent:!0}),this.model.user().playlists.list(n),this.render()},filterPlaylist:function(e){this.filter=e,this.render()},reset:function(){this.$("input[type=search]").val(""),this.$(".message").empty(),this.filter=""},createPlaylist:function(e){var t;e.length&&(t=this.model.user().playlists.createPlaylist(e),this.listenTo(t,"sync",function(e){this.header.resetState()}))}});return o});